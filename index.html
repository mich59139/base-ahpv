
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Base AHPV – Publications</title>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <link rel="stylesheet" 
        href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <style>
    body {{
      font-family: sans-serif;
      margin: 2em;
    }}
    h1 {{
      text-align: center;
    }}
    table {{
      width: 100%;
    }}
    .filters {{
      margin-bottom: 1em;
    }}
    label {{
      margin-right: 1em;
    }}
  </style>
</head>
<body>
  <h1>Publications de l'AHPV</h1>

  <div class="filters">
    <label>Auteur :
      <select id="filter-auteur"><option value="">Tous</option></select>
    </label>
    <label>Ville :
      <select id="filter-ville"><option value="">Toutes</option></select>
    </label>
    <label>Thème :
      <select id="filter-theme"><option value="">Tous</option></select>
    </label>
    <label>Époque :
      <select id="filter-epoque"><option value="">Toutes</option></select>
    </label>
  </div>

  <table id="table" class="display">
    <thead>
      <tr>
        <th>Mémoire</th>
        <th>Titre</th>
        <th>Page(s)</th>
        <th>Auteur(s)</th>
        <th>Ville(s)</th>
        <th>Thème(s)</th>
        <th>Époque</th>
      </tr>
    </thead>
  </table>

  <script>
    $(document).ready(function() {{
      $.get('base_ahpv_tri.csv', function(csv) {{
        const rows = csv.trim().split('\n').map(row => row.split(','));
        const headers = rows[0];
        const data = rows.slice(1).map(row => row.map(cell => cell.replace(/""/g, '"')));

        const table = $('#table').DataTable({{
          data: data,
          columns: headers.map(h => {{ return {{ title: h }} }}),
          order: [[0, 'asc']],
          language: {{
            url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json"
          }},
          pageLength: 100,
          lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "Tous"]]
        }});

        function populateFilter(colIndex, selector) {{
          const unique = new Set();
          table.column(colIndex).data().each(val => {{
            val.split(',').forEach(v => unique.add(v.trim()));
          }});
          Array.from(unique).sort().forEach(val => {{
            if (val && val !== '-') {{
              $(selector).append(`<option value="${{val}}">${{val}}</option>`);
            }}
          }});
          $(selector).on('change', function () {{
            const val = $.fn.dataTable.util.escapeRegex($(this).val());
            table.column(colIndex).search(val ? '^' + val + '$' : '', true, false).draw();
          }});
        }}

        populateFilter(3, '#filter-auteur');
        populateFilter(4, '#filter-ville');
        populateFilter(5, '#filter-theme');
        populateFilter(6, '#filter-epoque');
      }});
    }});
  </script>
</body>
</html>
